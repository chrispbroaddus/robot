This would be a great place to have notes!

*** Regenerating the project in STM32CubeMX ***

After changes are made in the STM32CubeMX project, you must select
"Generate source code based on user settings" in that tool. That will
regenerate all generated files, copying over from the previous versions
any code in the USER CODE sections. Make sure that all of our code lives
in those USER CODE sections or it will be wiped!

Unfortunately, the code as generated by STM32CubeMX has some bugs. You
must MANUALLY make the following changes after each time you regenerate
the code (line numbers are approximate and will change with options):

Middlewares/ST/STM32_USB_Device_Library/Class/CDC/Src/usbd_cdc.c:516:

  pdev->pClassData = USBD_malloc(sizeof (USBD_CDC_HandleTypeDef));

	becomes

  // MANUALLY MODIFIED, SEE README
  static USBD_CDC_HandleTypeDef allocated;
  pdev->pClassData = &allocated;

To make things fun, the build files generated by STM32CubeMX also have bugs!
You'll get one free build after generating the code and making the source
changes above. The /second/ build will fail with the error:

  /usr/make/sh: -c: line 0: syntax error near unexpected token `('
  
When you see this error, right click the project in the Project Explorer pain
and select Properties. Navigate to
  C/C++ Build > Settings > Tool Settings > MCU G++ Compiler > Preprocessor
Select the two lines
  __weak=__attribute__((weak))
  __packed=__attribute__((__packed__))
and delete them. Be sure not to delete them from the GCC Compiler settings!


*** Generating Code from Protobufs ***

This is done automatically at the start of each build, unconditionally. This
is potentially slow as we get to more protobufs, but has the advantage of
actually handling protobuf syntax errors correctly. The hook to do so is found
in the project Properties; navigate to
  Navigate to C/C++ Build > Settings > Build Steps > Pre-build steps > Command
The command used runs the Protos/bin-win/protoc_all.py script, which we own and
can modify as needed.

